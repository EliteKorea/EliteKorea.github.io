<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ê³µë¶€ í”Œë˜ë„ˆ</title>

<style>
*{box-sizing:border-box;}
body{
  margin:0;
  height:100vh;
  overflow:hidden; /* ìŠ¤í¬ë¡¤ ì™„ì „ ì°¨ë‹¨ */
  background:#cfe2ff;
  font-family:êµ´ë¦¼;
}
.page{
  width:100%;
  height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
}
.hidden{display:none;}

.box{
  background:#fff;
  border:4px solid #6b8cff;
  padding:20px;
  width:420px;
}

button,input{
  padding:6px;
  margin:4px;
}

h2{text-align:center}

/* ê³µë¶€ ì¼ì • */
.study-box{
  width:760px;
}
.study-wrap{
  display:flex;
  gap:20px;
}

/* íƒ€ì´ë¨¸ */
.timer{
  width:220px;
  text-align:center;
}
svg{
  transform:rotate(-90deg);
}
.time-text{
  position:absolute;
  width:140px;
  text-align:center;
  font-size:14px;
  margin-top:-90px;
}

/* ë‹¬ë ¥ */
.calendar{
  flex:1;
  display:grid;
  grid-template-columns:repeat(7,1fr);
  gap:4px;
}
.cell{
  height:90px;
  border:2px solid #8aa4ff;
}
.today{border:3px solid hotpink;}
textarea{
  width:100%;
  height:100%;
  border:none;
  resize:none;
}
</style>
</head>

<body>

<!-- ë¡œê·¸ì¸ -->
<div id="loginPage" class="page">
  <div class="box">
    <h2>ë¡œê·¸ì¸ / íšŒì›ê°€ì…</h2>
    <input id="lid" placeholder="ì•„ì´ë””">
    <input id="lpw" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸">
    <button onclick="doLogin()">ë¡œê·¸ì¸</button>
    <hr>
    <input id="sid" placeholder="ì•„ì´ë””">
    <input id="spw" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸">
    <button onclick="signup()">íšŒì›ê°€ì…</button>
  </div>
</div>

<!-- ë©”ì¸ -->
<div id="mainPage" class="page hidden">
  <div class="box">
    <h2 id="welcome"></h2>
    <p id="quote"></p>
    <button onclick="openStudy()">ğŸ“… ê³µë¶€ ì¼ì •</button>
    <button onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
  </div>
</div>

<!-- ê³µë¶€ ì¼ì • -->
<div id="studyPage" class="page hidden">
  <div class="box study-box">
    <button onclick="backMain()">â¬… ë©”ì¸</button>
    <h2 id="title"></h2>

    <div class="study-wrap">
      <!-- íƒ€ì´ë¨¸ -->
      <div class="timer">
        <input id="h" type="number" value="1" style="width:40px">ì‹œ
        <input id="m" type="number" value="0" style="width:40px">ë¶„
        <input id="s" type="number" value="0" style="width:40px">ì´ˆ
        <br>
        <button onclick="start()">ì‹œì‘</button>
        <button onclick="stop()">ì •ì§€</button>

        <div style="position:relative;margin-top:10px">
          <svg width="140" height="140">
            <circle cx="70" cy="70" r="60" stroke="#ddd" stroke-width="10" fill="none"/>
            <circle id="circle"
              cx="70" cy="70" r="60"
              stroke="#6b8cff"
              stroke-width="10"
              fill="none"
              stroke-dasharray="377"
              stroke-dashoffset="0"/>
          </svg>
          <div class="time-text" id="time">00:00:00</div>
        </div>
      </div>

      <!-- ë‹¬ë ¥ -->
      <div class="calendar" id="cal"></div>
    </div>
  </div>
</div>

<script>
/* ëª…ì–¸ */
const quotes=["ì˜¤ëŠ˜ì˜ ë…¸ë ¥ì´ ë‚´ì¼ì„ ë§Œë“ ë‹¤","ì¡°ê¸ˆì”© í•´ë„ ë©ˆì¶”ì§€ ë§ì"];
quote.innerText=quotes[Math.floor(Math.random()*quotes.length)];

/* íšŒì› */
function signup(){
  let users=JSON.parse(localStorage.getItem("users"))||{};
  if(users[sid.value]) return alert("ì´ë¯¸ ìˆìŒ");
  users[sid.value]=spw.value;
  localStorage.setItem("users",JSON.stringify(users));
  alert("íšŒì›ê°€ì… ì™„ë£Œ");
}
function doLogin(){
  let users=JSON.parse(localStorage.getItem("users"))||{};
  if(users[lid.value]===lpw.value){
    localStorage.setItem("user",lid.value);
    showMain();
  }else alert("ë¡œê·¸ì¸ ì‹¤íŒ¨");
}
function logout(){
  localStorage.removeItem("user");
  location.reload();
}

/* í™”ë©´ ì „í™˜ */
function showMain(){
  loginPage.classList.add("hidden");
  mainPage.classList.remove("hidden");
  welcome.innerText=localStorage.getItem("user")+"ë‹˜ í™˜ì˜!";
}
function openStudy(){
  mainPage.classList.add("hidden");
  studyPage.classList.remove("hidden");
  drawCalendar();
}
function backMain(){
  studyPage.classList.add("hidden");
  mainPage.classList.remove("hidden");
}
if(localStorage.getItem("user")) showMain();

/* íƒ€ì´ë¨¸ + ê²Œì´ì§€ */
let timer=null,total=0,remain=0;
const circle=document.getElementById("circle");
const length=377;

function start(){
  stop();
  total=remain=Number(h.value)*3600+Number(m.value)*60+Number(s.value);
  timer=setInterval(()=>{
    remain--;
    update();
    if(remain<=0) stop();
  },1000);
}
function stop(){clearInterval(timer);}
function update(){
  let p=remain/total;
  circle.style.strokeDashoffset=length*(1-p);
  time.innerText=
    String(Math.floor(remain/3600)).padStart(2,"0")+":"+
    String(Math.floor(remain%3600/60)).padStart(2,"0")+":"+
    String(remain%60).padStart(2,"0");
}

/* ë‹¬ë ¥ */
let memos=JSON.parse(localStorage.getItem("memos"))||{};
function drawCalendar(){
  cal.innerHTML="";
  const now=new Date();
  const y=now.getFullYear(),m=now.getMonth(),d=now.getDate();
  title.innerText=`${y}ë…„ ${m+1}ì›” ${d}ì¼`;
  const first=new Date(y,m,1).getDay();
  const last=new Date(y,m+1,0).getDate();

  for(let i=0;i<first;i++) cal.appendChild(document.createElement("div"));
  for(let i=1;i<=last;i++){
    const key=`${localStorage.getItem("user")}_${y}-${m+1}-${i}`;
    const c=document.createElement("div");
    c.className="cell"+(i===d?" today":"");
    const t=document.createElement("textarea");
    t.value=memos[key]||"";
    t.oninput=()=>{memos[key]=t.value;localStorage.setItem("memos",JSON.stringify(memos));};
    c.appendChild(t);
    cal.appendChild(c);
  }
}
</script>

</body>
</html>
